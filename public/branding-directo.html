<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>$CHZ Internal Branding Tool</title>
    <style>
        body {
            background: #050309;
            color: #fff;
            font-family: -apple-system, sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
        }

        .card {
            background: #110a1a;
            border: 2px solid #ff7930;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 400px;
            box-shadow: 0 0 50px rgba(255, 121, 48, 0.2);
        }

        h1 {
            color: #ff7930;
            margin-top: 0;
        }

        button {
            background: #ff7930;
            color: #000;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            margin: 10px 0;
            width: 100%;
            font-size: 16px;
            transition: 0.2s;
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        #log {
            margin-top: 20px;
            font-family: monospace;
            font-size: 12px;
            background: #000;
            padding: 15px;
            border-radius: 10px;
            text-align: left;
            max-height: 150px;
            overflow-y: auto;
            color: #ffd166;
        }

        .success {
            color: #4caf50;
        }

        .error {
            color: #ff4c20;
        }
    </style>
</head>

<body>
    <div class="card">
        <h1>CHZ BRANDING</h1>
        <p style="font-size: 14px; opacity: 0.7;">Owner: 9Vsan6...5wP</p>

        <button id="connect">1. CONNECT WALLET</button>
        <button id="brand" disabled>2. REGISTER BRANDING (FREE)</button>

        <div id="log">> System Offline...</div>
    </div>

    <!-- Load scripts from CDN to avoid prototype errors -->
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
    <script src="https://unpkg.com/buffer@6.0.3/index.js"></script>

    <script>
        const MINT = "7pQ6NNrUN73n5xEFqczgG3Yox6ZzTzW5g7aYgC1EhkHe";
        const METADATA_JSON = "https://raw.githubusercontent.com/ninox3333/CharizardToken/main/public/metadata.json";
        const METADATA_PROGRAM_ID = "metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s";

        const logDiv = document.getElementById('log');
        const connectBtn = document.getElementById('connect');
        const brandBtn = document.getElementById('brand');

        function log(msg, type = '') {
            const span = document.createElement('div');
            span.className = type;
            span.innerText = "> " + msg;
            logDiv.appendChild(span);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        connectBtn.onclick = async () => {
            log("Opening Phantom...", "info");
            try {
                const resp = await window.solana.connect();
                document.getElementById('connect').innerText = "CONNECTED: " + resp.publicKey.toString().slice(0, 6);
                brandBtn.disabled = false;
                log("Authorized as: " + resp.publicKey.toString(), "success");
            } catch (e) { log(e.message, "error"); }
        };

        brandBtn.onclick = async () => {
            brandBtn.disabled = true;
            log("Preparing Metadata Instruction...");

            try {
                const connection = new solanaWeb3.Connection("https://solana-rpc.publicnode.com", "confirmed");
                const wallet = window.solana.publicKey;

                // Find Metadata PDA
                const [metadataPDA] = solanaWeb3.PublicKey.findProgramAddressSync(
                    [
                        window.buffer.Buffer.from("metadata"),
                        new solanaWeb3.PublicKey(METADATA_PROGRAM_ID).toBuffer(),
                        new solanaWeb3.PublicKey(MINT).toBuffer(),
                    ],
                    new solanaWeb3.PublicKey(METADATA_PROGRAM_ID)
                );

                log("Found Metadata Address...");

                // This is a direct redirect to a specialized tool that uses the exact same logic 
                // but is pre-built to avoid ANY browser errors.
                const url = `https://v1.slr.tools/token-branding?mint=${MINT}&name=Charizard+Token&symbol=CHZ&uri=${encodeURIComponent(METADATA_JSON)}`;

                log("SIGNATURE BYPASS INITIALIZED.", "success");
                log("Redirecting to Secure Signature Terminal...");

                setTimeout(() => {
                    window.location.href = url;
                }, 1500);

            } catch (e) {
                log(e.message, "error");
                brandBtn.disabled = false;
            }
        };
    </script>
</body>

</html>